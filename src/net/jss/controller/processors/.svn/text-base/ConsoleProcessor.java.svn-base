package net.saje.controller.processors;

import java.io.IOException;

import javax.servlet.RequestDispatcher;
import javax.servlet.ServletContext;
import javax.servlet.ServletException;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import net.saje.js.ScriptCore;

public class ConsoleProcessor implements SajeProcessor {

	/**
	 * 
	 */
	private static final long serialVersionUID = 1L;

	@Override
	public void doGet(HttpServletRequest request, HttpServletResponse response,
			ServletContext servletContext) throws ServletException, IOException {
	
		RequestDispatcher dispatcher = servletContext
				.getRequestDispatcher("/console.jsp");
		dispatcher.forward(request, response);
	}

	@Override
	public void doPost(HttpServletRequest request,
			HttpServletResponse response, ServletContext servletContext)
			throws ServletException, IOException {

		if (request.getParameter("jscode") != null) {
			String code = request.getParameter("jscode");
			ScriptCore sc = ScriptCore.getInstance();

			Object o = sc.executeScript(code);
			if (o == null) {
				response.getOutputStream().write("null".getBytes());
			} else {
				response.getOutputStream().write(o.toString().getBytes());
			}
		}
	}
}
